(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3a88879e"],{"66af":function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"f",function(){return s}),n.d(t,"c",function(){return l}),n.d(t,"b",function(){return r}),n.d(t,"d",function(){return o}),n.d(t,"e",function(){return c}),n.d(t,"g",function(){return u});var a=n("b775");function i(){return Object(a["a"])({url:"/general/biz/list",method:"get"})}function s(e){return Object(a["a"])({url:"/general/product/list",method:"get",params:e})}function l(){return Object(a["a"])({url:"/general/city/list",method:"get"})}function r(e){return Object(a["a"])({url:"/general/center/list",method:"get",params:{cityCode:e}})}function o(e){return Object(a["a"])({url:"/general/get/code",method:"get",params:{idCodeType:e}})}function c(e){return Object(a["a"])({url:"/general/org/list",method:"get",params:{parentCode:e}})}function u(){return Object(a["a"])({url:"/scene/findAllScene",method:"get"})}},6724:function(e,t,n){"use strict";n("8d41");var a="@@wavesContext";function i(e,t){function n(n){var a=Object.assign({},t.value),i=Object.assign({ele:e,type:"hit",color:"rgba(0, 0, 0, 0.15)"},a),s=i.ele;if(s){s.style.position="relative",s.style.overflow="hidden";var l=s.getBoundingClientRect(),r=s.querySelector(".waves-ripple");switch(r?r.className="waves-ripple":(r=document.createElement("span"),r.className="waves-ripple",r.style.height=r.style.width=Math.max(l.width,l.height)+"px",s.appendChild(r)),i.type){case"center":r.style.top=l.height/2-r.offsetHeight/2+"px",r.style.left=l.width/2-r.offsetWidth/2+"px";break;default:r.style.top=(n.pageY-l.top-r.offsetHeight/2-document.documentElement.scrollTop||document.body.scrollTop)+"px",r.style.left=(n.pageX-l.left-r.offsetWidth/2-document.documentElement.scrollLeft||document.body.scrollLeft)+"px"}return r.style.backgroundColor=i.color,r.className="waves-ripple z-active",!1}}return e[a]?e[a].removeHandle=n:e[a]={removeHandle:n},n}var s={bind:function(e,t){e.addEventListener("click",i(e,t),!1)},update:function(e,t){e.removeEventListener("click",e[a].removeHandle,!1),e.addEventListener("click",i(e,t),!1)},unbind:function(e){e.removeEventListener("click",e[a].removeHandle,!1),e[a]=null,delete e[a]}},l=function(e){e.directive("waves",s)};window.Vue&&(window.waves=s,Vue.use(l)),s.install=l;t["a"]=s},"8d41":function(e,t,n){},c621:function(e,t,n){"use strict";n.d(t,"g",function(){return i}),n.d(t,"h",function(){return s}),n.d(t,"n",function(){return l}),n.d(t,"f",function(){return r}),n.d(t,"a",function(){return o}),n.d(t,"k",function(){return c}),n.d(t,"j",function(){return u}),n.d(t,"d",function(){return d}),n.d(t,"m",function(){return p}),n.d(t,"l",function(){return m}),n.d(t,"i",function(){return f}),n.d(t,"c",function(){return h}),n.d(t,"b",function(){return g}),n.d(t,"e",function(){return v});var a=n("b775");function i(e){return Object(a["a"])({url:"/template/valid/list",method:"get",params:{sceneCode:e}})}function s(e){var t=JSON.stringify(e);return Object(a["a"])({url:"/template/page/list",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:t})}function l(e){return Object(a["a"])({url:"/template/valid",method:"get",params:{templateCode:e}})}function r(e){return Object(a["a"])({url:"/template/invalid",method:"get",params:{templateCode:e}})}function o(e,t){return Object(a["a"])({url:"/template/default",method:"get",params:{templateCode:e,sceneCode:t}})}function c(e){var t=JSON.stringify(e);return console.log(t),Object(a["a"])({url:"/template/add",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:t})}function u(e){var t=JSON.stringify(e);return Object(a["a"])({url:"/template/save/random/question",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:t})}function d(e,t){return Object(a["a"])({url:"/template/detail/"+e+"/"+t,method:"get"})}function p(e){var t=JSON.stringify(e);return Object(a["a"])({url:"/template/update/template",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:t})}function m(e){var t=JSON.stringify(e);return Object(a["a"])({url:"/template/update/question",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:t})}function f(e){var t=JSON.stringify(e);return Object(a["a"])({url:"/template/save/question",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:t})}function h(e){return Object(a["a"])({url:"/template/delete/template/"+e,method:"get"})}function g(e){var t=JSON.stringify(e);return Object(a["a"])({url:"/template/delete/question",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:t})}function v(e){var t=JSON.stringify(e);return Object(a["a"])({url:"/template/set/question/indexAndWeight",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:t})}},d4fe:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container"},[n("div",{staticClass:"filter-container"},[n("el-form",{ref:"form",staticClass:"demo-form-inline",attrs:{model:e.listQuery,"label-width":"20px","label-position":"left"}},[n("el-row",[n("el-col",{attrs:{span:8}},[n("el-form-item",{attrs:{"label-width":"80px",label:"业务线:"}},[n("el-select",{staticClass:"filter-item",staticStyle:{"max-width":"150px"},attrs:{placeholder:"请选择",clearable:""},model:{value:e.listQuery.lineCode,callback:function(t){e.$set(e.listQuery,"lineCode",t)},expression:"listQuery.lineCode"}},e._l(e.bizLines,function(e){return n("el-option",{key:e.value,attrs:{label:e.lable,value:e.value}})}),1)],1)],1),e._v(" "),n("el-col",{attrs:{span:8}},[n("el-form-item",{attrs:{"label-width":"80px",label:"场景名称:"}},[n("el-input",{staticClass:"filter-item",staticStyle:{"max-width":"200px"},attrs:{placeholder:"场景名称"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleFilter(t)}},model:{value:e.listQuery.sceneName,callback:function(t){e.$set(e.listQuery,"sceneName",t)},expression:"listQuery.sceneName"}})],1)],1),e._v(" "),n("el-col",{attrs:{span:8}},[n("el-form-item",{attrs:{"label-width":"80px",label:"状态:"}},[n("el-select",{staticClass:"filter-item",staticStyle:{"max-width":"130px"},attrs:{placeholder:"是否有效",clearable:""},model:{value:e.listQuery.isValid,callback:function(t){e.$set(e.listQuery,"isValid",t)},expression:"listQuery.isValid"}},e._l(e.calendarTypeOptions,function(e){return n("el-option",{key:e.key,attrs:{label:e.display_name,value:e.key}})}),1)],1)],1)],1)],1),e._v(" "),n("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"filter-item",staticStyle:{float:"right"},attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.getSceneList(1)}}},[e._v("\n      查询\n    ")]),e._v(" "),n("el-button",{staticClass:"filter-item",staticStyle:{float:"right","margin-right":"20px"},attrs:{type:"primary",icon:"el-icon-edit"},on:{click:e.handleCreateScene}},[e._v("\n      新增\n    ")])],1),e._v(" "),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],key:e.tableKey,staticStyle:{width:"100%"},attrs:{data:e.list,border:"",fit:"","highlight-current-row":""}},[n("el-table-column",{attrs:{align:"center",label:"序号",type:"index","max-width":"50"}}),e._v(" "),n("el-table-column",{attrs:{label:"场景名称","max-width":"180px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.row.sceneName))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"场景编码","max-width":"180px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.row.sceneCode))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"业务线","max-width":"180px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.row.bizLineName))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"当前默认模板","max-width":"180px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("a",{staticStyle:{color:"#1482f0"},attrs:{href:"javascript:void (0)"},on:{click:function(n){return e.updateTemplate(t.row.templateCode)}}},[n("span",[e._v(e._s(t.row.templateName))])])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"模板编码","max-width":"180px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.row.templateCode))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"状态","max-width":"150px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.row.isValid))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"最后修改人","max-width":"150px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.row.lastModifyId))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"最后修改时间",align:"center","max-width":"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.row.lastModifyTime))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"操作",align:"center","min-width":"230","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(n){return e.handleUpdateScene(t.row)}}},[e._v("\n          修改\n        ")]),e._v(" "),"启用"!==t.row.isValid?n("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(n){return e.handleValid(t.row,t.row.sceneCode)}}},[e._v("\n          启用\n        ")]):e._e(),e._v(" "),"禁用"!==t.row.isValid?n("el-button",{attrs:{size:"mini"},on:{click:function(n){return e.handleInValid(t.row,t.row.sceneCode)}}},[e._v("\n          禁用\n        ")]):e._e(),e._v(" "),n("el-popover",{ref:"popover-"+t.row.sceneCode,attrs:{placement:"top",width:"160",trigger:"manual"}},[n("p",[e._v("确定删除当前场景吗?")]),e._v(" "),n("div",{staticStyle:{"text-align":"right",margin:"10px"}},[n("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(n){return e.pCancel(t.row.sceneCode)}}},[e._v("取消")]),e._v(" "),n("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(n){return e.handleDelete(t.$index,t.row.sceneCode)}}},[e._v("确定")])],1),e._v(" "),n("el-button",{attrs:{slot:"reference",size:"mini",type:"danger"},on:{click:function(n){return e.pOpen(t.row.sceneCode)}},slot:"reference"},[e._v("\n            删除\n          ")])],1)]}}])})],1),e._v(" "),n("div",{staticClass:"projects-data-footer"},[n("el-pagination",{attrs:{total:e.pageInfo.totalRecord,"page-size":e.pageInfo.pageSize,"current-page":e.pageInfo.currentPage,"page-sizes":[10,20,30,40],layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),n("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[n("el-form",{ref:"sceneDataForm",staticStyle:{width:"400px","margin-left":"50px"},attrs:{rules:e.rules,model:e.sceneTemp,"label-position":"left","label-width":"100px"}},[n("el-form-item",{attrs:{label:"场景名称",prop:"title"}},[n("el-input",{model:{value:e.sceneTemp.sceneName,callback:function(t){e.$set(e.sceneTemp,"sceneName",t)},expression:"sceneTemp.sceneName"}})],1),e._v(" "),"update"===e.dialogStatus?n("el-form-item",{attrs:{label:"场景编码"}},[n("el-input",{attrs:{disabled:!0},model:{value:e.sceneTemp.sceneCode,callback:function(t){e.$set(e.sceneTemp,"sceneCode",t)},expression:"sceneTemp.sceneCode"}})],1):e._e(),e._v(" "),n("el-form-item",{attrs:{label:"业务线",prop:"bizLineCode"}},[n("el-select",{staticClass:"filter-item",attrs:{clearable:"",placeholder:"请选择"},model:{value:e.sceneTemp.bizLineCode,callback:function(t){e.$set(e.sceneTemp,"bizLineCode",t)},expression:"sceneTemp.bizLineCode"}},e._l(e.bizLines,function(e){return n("el-option",{key:e.value,attrs:{label:e.lable,value:e.value}})}),1)],1)],1),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("\n        取消\n      ")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(t){"create"===e.dialogStatus?e.createSceneData():e.updateSceneData()}}},[e._v("\n        提交\n      ")])],1)],1)],1)},i=[],s=(n("ac6a"),n("b775"));function l(e){var t=JSON.stringify(e);return Object(s["a"])({url:"/scene/page/list",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:t})}function r(e){return Object(s["a"])({url:"/scene/valid",method:"get",params:{sceneCode:e}})}function o(e){return Object(s["a"])({url:"/scene/invalid",method:"get",params:{sceneCode:e}})}function c(e){return Object(s["a"])({url:"/scene/delete",method:"get",params:{sceneCode:e}})}function u(e){var t=JSON.stringify(e);return Object(s["a"])({url:"/scene/save",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:t})}var d=n("66af"),p=n("c621"),m=n("6724"),f=n("ed08"),h=[{key:"",display_name:"全部",value:2},{key:"1",display_name:"启用",value:1},{key:"0",display_name:"禁用",value:0}],g=h.reduce(function(e,t){return e[t.key]=t.display_name,e},{}),v={name:"Scene",components:{},directives:{waves:m["a"]},filters:{statusFilter:function(e){var t={published:"success",draft:"info",deleted:"danger"};return t[e]},typeFilter:function(e){return g[e]}},data:function(){return{tableKey:0,list:null,total:0,listLoading:!0,listQuery:{pageNum:1,pageSize:10,lineCode:"",sceneName:"",isValid:""},bizLines:[],templateCodes:[],calendarTypeOptions:h,sceneStatusOptions:["禁用","启用"],showReviewer:!1,dialogFormVisible:!1,dialogStatus:"",textMap:{update:"修改场景",create:"新增场景"},sceneTemp:{id:void 0,sceneCode:"",sceneName:"",questionShowStrategy:"",bizLineCode:"",bizLineName:"",isValid:1,frequencyType:"",cycleUnit:"",cycleDuration:"",templateCode:""},rules:{sceneName:[{required:!0,message:"场景名称不能为空",trigger:"change"}],bizLineCode:[{required:!0,message:"请选择业务线",trigger:"blur"}]},pageInfo:{totalRecord:0,currentPage:1,pageSize:10}}},created:function(){this.getLines(),this.getSceneList()},mounted:function(){this.getSceneList()},methods:{getLines:function(){var e=this;this.listLoading=!0,Object(d["a"])().then(function(t){var n=[];t.data.forEach(function(e){n.push({value:e.bizLineCode,lable:e.bizLineName})}),e.bizLines=n,e.listLoading=!1}).catch(function(){e.listLoading=!1})},getTemplates:function(e){var t=this;this.listLoading=!0,Object(p["g"])(e).then(function(e){var n=[];e.data.forEach(function(e){n.push({value:e.templateCode,lable:e.templateName})}),console.log(t.templateCodes),t.templateCodes=n,console.log(t.templateCodes),t.listLoading=!1}).catch(function(){t.listLoading=!1})},getSceneList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.pageInfo.currentPage,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.pageInfo.pageSize;this.listLoading=!0,"number"===typeof t&&(this.listQuery.pageNum=t),null!=n&&(this.listQuery.pageSize=n),l(this.listQuery).then(function(t){e.list=t.data.list,e.$set(e.pageInfo,"totalRecord",t.data.total),e.$set(e.pageInfo,"currentPage",t.data.pageNum),e.listLoading=!1}).catch(function(){e.listLoading=!1})},resetSceneTemp:function(){this.sceneTemp={id:void 0,sceneCode:"",sceneName:"",questionShowStrategy:"",bizLineCode:"",isValid:1,frequencyType:"",cycleUnit:"",cycleDuration:"",templateCode:""}},handleCreateScene:function(){var e=this;this.resetSceneTemp(),this.dialogStatus="create",this.dialogFormVisible=!0,this.$nextTick(function(){e.$refs["sceneDataForm"].clearValidate()})},createSceneData:function(){var e=this;this.$refs["sceneDataForm"].validate(function(t){t&&u(e.sceneTemp).then(function(){e.dialogFormVisible=!1,e.$notify({title:"Success",message:"新增场景成功",type:"success",duration:2e3}),e.getSceneList(1,e.listQuery.pageSize)})})},handleUpdateScene:function(e){var t=this;this.sceneTemp=Object.assign({},e),this.sceneTemp.isValid="1",this.dialogStatus="update",this.dialogFormVisible=!0,this.$nextTick(function(){t.$refs["sceneDataForm"].clearValidate()}),console.log(e.sceneCode),this.getTemplates(e.sceneCode)},updateSceneData:function(){var e=this;this.$refs["sceneDataForm"].validate(function(t){if(t){var n=Object.assign({},e.sceneTemp);u(n).then(function(t){"success"===t.status?(e.dialogFormVisible=!1,e.$notify({title:"Success",message:"修改场景成功",type:"success",duration:2e3}),e.getSceneList(1,e.listQuery.pageSize)):(e.dialogFormVisible=!1,e.$notify({title:"Fail",message:"修改场景失败",type:"error",duration:2e3}))})}})},handleDelete:function(e,t){var n=this;c(t).then(function(a){"success"===a.status?(n.$message({message:a.message,type:"success"}),n.list.splice(e,1),n.pClose(t),n.getSceneList(1,n.listQuery.pageSize)):n.$message({message:"启用失败",type:"false"})})},handleValid:function(e,t){var n=this;r(t).then(function(t){"success"===t.status?(n.$message({message:t.message,type:"success"}),e.isValid=n.sceneStatusOptions[1]):n.$message({message:"启用失败",type:"false"})})},handleInValid:function(e,t){var n=this;o(t).then(function(t){"success"===t.status?(n.$message({message:t.message,type:"success"}),e.isValid=n.sceneStatusOptions[0]):n.$message({message:"禁用失败",type:"false"})})},handleFilter:function(){this.listQuery.page=1,this.getSceneList()},formatJson:function(e,t){return t.map(function(t){return e.map(function(e){return"timestamp"===e?Object(f["d"])(t[e]):t[e]})})},handleSizeChange:function(e){this.$set(this.listQuery,"pageSize",e),this.listQuery.pageSize=e,this.getSceneList(1,e)},handleCurrentChange:function(e){this.getSceneList(e,this.listQuery.pageSize)},pCancel:function(e){this.pClose(e)},pClose:function(e){this.$refs["popover-"+e].doClose()},pOpen:function(e){this.$refs["popover-"+e].doShow()},updateTemplate:function(e){this.$router.push({name:"SaveTemplate",params:{templateCode:e,isEdit:!0,isDisable:!0}})}}},b=v,y=n("2877"),C=Object(y["a"])(b,a,i,!1,null,null,null);t["default"]=C.exports}}]);